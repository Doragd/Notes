# Python核心技术与实战
!!! tip
    这里记录一下在极客时间买的Python课程的笔记

![python-graph](../../images/python-graph.png)

## 列表和元组，到底用哪一个？

### 基础知识

* 相同点: 列表和元组，都是一个可以放置任意数据类型的有序集合，都支持负数索引，都支持切片操作，可以随意嵌套，可以通过 `list()` 和 `tuple()` 函数相互转换。
* 不同点: 列表是动态的，长度大小不固定，可以随意地增加、删减或者改变元素（mutable）。而元组是静态的，长度大小固定，无法增加删减或者改变（immutable）。

### 列表和元组存储方式的差异

```python
l = [1, 2, 3]
l.__sizeof__() # 64
tup = (1, 2, 3)
tup.__sizeof__() # 48


l = []
l.__sizeof__() # 空列表的存储空间为40字节
40
l.append(1)
l.__sizeof__() 
72 # 加入了元素1之后，列表为其分配了可以存储4个元素的空间 (72 - 40)/8 = 4
l.append(2) 
l.__sizeof__()
72 # 由于之前分配了空间，所以加入元素2，列表空间不变
l.append(3)
l.__sizeof__() 
72 # 同上
l.append(4)
l.__sizeof__() 
72 # 同上
l.append(5)
l.__sizeof__() 
104 # 加入元素5之后，列表的空间不足，所以又额外分配了可以存储4个元素的空间
```
* 用`__sizeof__()`可以看对象占有的空间(字节)。
* 列表不同于元组，列表是动态的，所以它需要存储指针，来指向对应的元素（上述例子中，对于 int 型，8 字节）。另外，由于列表可变，所以需要额外存储已经分配的长度大小（8 字节）。
* 在列表增删元素时，为了减小每次增加 / 删减操作时空间分配的开销，Python 每次分配空间时都会额外多分配一些，这样的机制（over-allocating）保证了其操作的高效性：增加 / 删除的时间复杂度均为 $O(1)$
* 元组长度大小固定，元素不可变，所以存储空间固定

### 列表和元组的性能
* 元组要比列表更加轻量级一些，所以总体上来说，元组的性能速度要略优于列表。你想要增加、删减或者改变元素，那么列表显然更优，因为元组要新建一个来完成。
* Python 会在后台，对静态数据做一些资源缓存（resource caching）。通常来说，因为垃圾回收机制的存在，如果一些变量不被使用了，Python 就会回收它们所占用的内存，返还给操作系统，以便其他变量或其他应用使用
* 对于一些静态变量，比如元组，如果它不被使用并且占用空间不大时，Python 会暂时缓存这部分内存。这样，下次我们再创建同样大小的元组时，Python 就可以不用再向操作系统发出请求，去寻找内存，而是可以直接分配之前缓存的内存空间，这样就能大大加快程序的运行速度。

### 总结
* 列表和元组都是有序的，可以存储任意数据类型的集合。
* 列表是动态的，长度可变，可以随意的增加、删减或改变元素。列表的存储空间略大于元组，性能略逊于元组。
* 元组是静态的，长度大小固定，不可以对元素进行增加、删减或者改变操作。元组相对于列表更加轻量级，性能稍优。
* 使用场景主要看存储的数据是否可变动态


!!! warning "用`list()`还是 `[]`"

    主要在于`list()`是一个`function call`，Python的`function call`会创建stack，并且进行一系列参数检查的操作，比较expensive，反观`[]`是一个内置的C函数，可以直接被调用，因此效率高。



